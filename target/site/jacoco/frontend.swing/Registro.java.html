<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Registro.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Proceso-y-SW-de-calidad</a> &gt; <a href="index.source.html" class="el_package">frontend.swing</a> &gt; <span class="el_source">Registro.java</span></div><h1>Registro.java</h1><pre class="source lang-java linenums">package frontend.swing;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.EventQueue;

import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.border.EmptyBorder;

import backend.objects.Pelicula;
import backend.objects.personas.Persona;
import backend.objects.personas.Usuario;
import frontend.controller.Controller;
import frontend.swing.Login;
import frontend.swing.VentanaPrincipal;

import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JTextField;
import javax.swing.Icon;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import java.awt.event.ActionListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.util.HashMap;
import java.awt.event.ActionEvent;
import java.awt.Font;
import java.awt.HeadlessException;

import javax.swing.JPasswordField;


public class Registro extends JFrame {

	private JPanel contentPane;
	private JTextField textUsuario;
	private JTextField textReal;
	private VentanaPrincipal principal ;	
	private JPasswordField passwordField;
	

	public Registro() throws HeadlessException {
<span class="nc" id="L45">		super();</span>
<span class="nc" id="L46">		textReal = new JTextField();</span>
<span class="nc" id="L47">		passwordField = new JPasswordField();</span>
<span class="nc" id="L48">	}</span>

<span class="nc" id="L50">	public Registro(VentanaPrincipal ventanaPrincipal) {</span>
		
<span class="nc" id="L52">		setResizable(false);</span>
<span class="nc" id="L53">		principal = ventanaPrincipal;</span>
<span class="nc" id="L54">		setTitle(&quot;Login&quot;);</span>
<span class="nc" id="L55">		HashMap&lt;String, Persona&gt; hashUsuarios=ventanaPrincipal.getHashUsuarios();</span>
		
<span class="nc" id="L57">		setTitle(&quot;Registro de Usuario&quot;);</span>
<span class="nc" id="L58">		setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);</span>
<span class="nc" id="L59">		setBounds(100, 100, 455, 303);</span>
<span class="nc" id="L60">		contentPane = new JPanel();</span>
<span class="nc" id="L61">		contentPane.setBackground(Color.WHITE);</span>
<span class="nc" id="L62">		contentPane.setBorder(new EmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L63">		setContentPane(contentPane);</span>
<span class="nc" id="L64">		contentPane.setLayout(null);</span>
		
<span class="nc" id="L66">		JLabel lblNombreUsuario = new JLabel(&quot;Nombre Usuario:&quot;);</span>
<span class="nc" id="L67">		lblNombreUsuario.setFont(new Font(&quot;Tahoma&quot;, Font.PLAIN, 20));</span>
<span class="nc" id="L68">		lblNombreUsuario.setBounds(32, 39, 187, 20);</span>
<span class="nc" id="L69">		contentPane.add(lblNombreUsuario);</span>
		
<span class="nc" id="L71">		JLabel lblNombreReal = new JLabel(&quot;Nombre Real:&quot;);</span>
<span class="nc" id="L72">		lblNombreReal.setFont(new Font(&quot;Tahoma&quot;, Font.PLAIN, 20));</span>
<span class="nc" id="L73">		lblNombreReal.setBounds(32, 92, 123, 20);</span>
<span class="nc" id="L74">		contentPane.add(lblNombreReal);</span>
		
<span class="nc" id="L76">		JLabel lblContrasea = new JLabel(&quot;Contrase\u00F1a:&quot;);</span>
<span class="nc" id="L77">		lblContrasea.setFont(new Font(&quot;Tahoma&quot;, Font.PLAIN, 20));</span>
<span class="nc" id="L78">		lblContrasea.setBounds(32, 147, 141, 20);</span>
<span class="nc" id="L79">		contentPane.add(lblContrasea);</span>
		
<span class="nc" id="L81">		textUsuario = new JTextField();</span>
<span class="nc" id="L82">		textUsuario.setBounds(216, 41, 165, 20);</span>
<span class="nc" id="L83">		contentPane.add(textUsuario);</span>
<span class="nc" id="L84">		textUsuario.setColumns(10);</span>
		
<span class="nc" id="L86">		textReal = new JTextField();</span>
<span class="nc" id="L87">		textReal.setBounds(216, 94, 165, 20);</span>
<span class="nc" id="L88">		contentPane.add(textReal);</span>
<span class="nc" id="L89">		textReal.setColumns(10);</span>
		
<span class="nc" id="L91">		JButton btnVolver = new JButton(&quot;Cancelar&quot;);</span>
<span class="nc" id="L92">		btnVolver.setBounds(312, 202, 115, 29);</span>
<span class="nc" id="L93">		contentPane.add(btnVolver);</span>
		
<span class="nc" id="L95">		JButton btnOk = new JButton(&quot;OK&quot;);</span>
<span class="nc" id="L96">		btnOk.setBounds(162, 202, 115, 29);</span>
<span class="nc" id="L97">		contentPane.add(btnOk);</span>
		
<span class="nc" id="L99">		passwordField = new JPasswordField();</span>
<span class="nc" id="L100">		passwordField.setBounds(216, 149, 165, 20);</span>
<span class="nc" id="L101">		contentPane.add(passwordField);</span>
		
<span class="nc" id="L103">		btnOk.addActionListener(new ActionListener() {				</span>
			public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L105" title="All 6 branches missed.">				if(!textUsuario.getText().isEmpty()&amp;&amp;!passwordField.getText().isEmpty()&amp;&amp;!textReal.getText().isEmpty())</span>
				{
<span class="nc" id="L107">					String username=textUsuario.getText();</span>
<span class="nc" id="L108">					boolean valor=false;</span>
					try {

<span class="nc" id="L111">						comprobarUsuario(username,hashUsuarios);//valor=</span>
<span class="nc" id="L112">						Usuario nuevoUsuario=null;//solo se pueden crear usuarios estandar luego se dara la posibilidad de que sean premium</span>
<span class="nc" id="L113">						String contrasenya=passwordField.getText();</span>
<span class="nc" id="L114">						String nombreReal=textReal.getText();</span>
<span class="nc" id="L115">						comprobarPrimaryKey(username,hashUsuarios);//compruebo que nombre real y la pass no coincidan con el username porque tiene que ser unique en la base de datos</span>
<span class="nc" id="L116">						nuevoUsuario = new Usuario(username,contrasenya,nombreReal);</span>
<span class="nc" id="L117">						hashUsuarios.put(username, nuevoUsuario);</span>
<span class="nc" id="L118">						principal.setHashUsuarios(hashUsuarios);</span>

						// AQUÍ INSERTAR EL USUARIO A LA BASE DE DATOS

						// No funciona sin que el metodo sea statico...Principal.exportUsuario(null, nuevoUsuario);


<span class="nc" id="L125">						cancelar();</span>

<span class="nc" id="L127">					}catch(Exception e1){</span>
<span class="nc" id="L128">						JOptionPane.showMessageDialog(Registro.this, e1.getMessage(),&quot;Error&quot;,JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L129">					}</span>
<span class="nc" id="L130">				}</span>
				else
				{
<span class="nc" id="L133">					JOptionPane.showMessageDialog(Registro.this, &quot;Debes rellenar todas las casillas.&quot;,&quot;Error&quot;,JOptionPane.ERROR_MESSAGE);</span>
				}
<span class="nc" id="L135">		}</span>
		});

<span class="nc" id="L138">		btnVolver.addActionListener(new ActionListener() {</span>
			public void actionPerformed(ActionEvent e) {
<span class="nc" id="L140">				cancelar();</span>
<span class="nc" id="L141">			}</span>
		});
		
<span class="nc" id="L144">		Registro.this.addWindowListener(new WindowAdapter() {//lo que hace al dar a la X</span>
			   public void windowClosing(WindowEvent evt) {
<span class="nc" id="L146">			        int respuesta = JOptionPane.showOptionDialog(Registro.this, &quot;�Est�s seguro de salir?&quot;,&quot;Confirmar&quot;, JOptionPane.YES_NO_OPTION,JOptionPane.QUESTION_MESSAGE, null, null, null);</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">			        if (respuesta == 0) </span>
			        {
<span class="nc" id="L149">			        	System.exit(0);//para que se cierre</span>
			        }
<span class="nc" id="L151">			   	}</span>
		});
		
<span class="nc" id="L154">	}</span>
	
	public void setTextReal(String nomReal) {
<span class="nc" id="L157">		this.textReal.setText(nomReal);</span>
<span class="nc" id="L158">	}</span>

	public void setTextPasswordField(String pass) {
<span class="nc" id="L161">		this.passwordField.setText(pass); </span>
<span class="nc" id="L162">	}</span>
	

	public boolean comprobarUsuario(String username,HashMap&lt;String, Persona&gt; hashUsuarios) throws Exception //static para acceder desde modificar si cambia nombre usuario
	{
<span class="nc bnc" id="L167" title="All 2 branches missed.">		if(hashUsuarios.containsKey(username))</span>
		{
<span class="nc" id="L169">			throw new Exception(&quot;Ese usuario ya existe. Pruebe con otro.&quot;);</span>
		}
<span class="nc" id="L171">		return true;</span>
		
	}
	
	public boolean comprobarPrimaryKey(String username,HashMap&lt;String, Persona&gt; hashUsuarios) throws Exception //static para acceder desde modificar si cambia nombre usuario
	{
<span class="nc bnc" id="L177" title="All 2 branches missed.">		if(username.equals(passwordField.getText()))</span>
		{
<span class="nc" id="L179">			throw new Exception(&quot;La contraseña y el nombre de usuario no pueden coincidir.&quot;);</span>
		}
<span class="nc bnc" id="L181" title="All 2 branches missed.">		else if(username.equals(textReal.getText()))</span>
		{
<span class="nc" id="L183">			throw new Exception(&quot;El nombre real y el nombre de usuario no pueden coincidir.&quot;);</span>
		}
<span class="nc" id="L185">		return true;</span>
	}


	public void cancelar()
	{
<span class="nc" id="L191">		principal.setLocationRelativeTo(Registro.this);</span>
<span class="nc" id="L192">		principal.setVisible(true);</span>
<span class="nc" id="L193">		Registro.this.dispose();</span>
<span class="nc" id="L194">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>